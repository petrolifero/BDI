CC = gcc
CFLAGS = -Werror -g -std=c99

ifdef ComSpec
  SEP2=\\
  MD = mkdirp.bat
  RM = del /F /Q
  RD = rd /S /Q
  CREATE = @(echo ^@echo off & echo ^IF EXIST %%1 GOTO END & echo ^MKDIR %%1 & echo ^:END)> mkdirp.bat
else
  SEP2=/
  MD = mkdir -p
  RM = rm -rf
  RD = rm -rf
  CREATE = 
endif

SEP=$(strip $(SEP2))

ODIR = .$(SEP)build
IDIR = .

CFLAGS+=-I$(IDIR)

_OBJ = no.o ref.o cod.o heap.o huffman.o test_huffman.o
#cod.o ref.o heap.o huffman.o
OBJ = $(patsubst %,$(ODIR)$(SEP)%,$(_OBJ))

$(ODIR)$(SEP)%.o: $(IDIR)$(SEP)%.c $(DEPS)
	${CREATE}
	${MD} $(ODIR)
	${CC} -c -o $@ $< $(CFLAGS)

main: $(OBJ) -lm
	${CC} -o $(ODIR)$(SEP)$@ $^ $(CFLAGS)
	@valgrind --leak-check=full ./build/main

.PHONY: clean

clean:
	${RM} *~ mkdirp.bat
	${RD} $(ODIR)$(SEP)
